From c1a504fbdb0fbee5d6f3fb3a73830b30d818e287 Mon Sep 17 00:00:00 2001
From: Philipp Baumann <baumann-philipp@protonmail.com>
Date: Thu, 21 Dec 2023 20:00:37 +0100
Subject: [PATCH] soci: fix darwin build

Co-authored-by: Weijia Wang <9713184+wegank@users.noreply.github.com>
---
 pkgs/development/libraries/soci/default.nix | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/pkgs/development/libraries/soci/default.nix b/pkgs/development/libraries/soci/default.nix
index 154924922ad0d8..007a4fbaf7bf40 100644
--- a/pkgs/development/libraries/soci/default.nix
+++ b/pkgs/development/libraries/soci/default.nix
@@ -4,9 +4,12 @@
 , sqlite
 , postgresql
 , boost
+, darwin
 , lib, stdenv
 }:
-
+let
+  inherit (darwin.apple_sdk_11_0.frameworks) Kerberos;
+in
 stdenv.mkDerivation rec {
   pname = "soci";
   version = "4.0.2";
@@ -34,6 +37,8 @@ stdenv.mkDerivation rec {
     sqlite
     postgresql
     boost
+  ] ++ lib.optionals stdenv.isDarwin [
+    Kerberos
   ];
 
   meta = with lib; {
